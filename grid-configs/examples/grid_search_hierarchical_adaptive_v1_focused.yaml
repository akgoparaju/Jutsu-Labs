# Grid Search Configuration for Hierarchical Adaptive v1.0 (FOCUSED)
# ========================================================
# Fast iteration grid search with minimal parameter combinations (16 runs)
# for quick validation of Hierarchical Adaptive v1.0 strategy.
#
# Strategy Overview:
# - TIER 0: VIX Volatility Filter (master switch) - NEW
# - TIER 1: Kalman Filter Trend Strength Oscillator (-100 to +100)
# - TIER 2: 4 Regimes: Strong Bull, Moderate Bull, Chop/Neutral, Bear
# - TIER 3: 4 Trading Vehicles: TQQQ (3x long), QQQ (1x), SQQQ (3x inverse), CASH
# - TIER 4: Regime-Specific Logic: Each regime has different EMA/MACD parameters
#
# Focused Parameter Strategy:
# - Fix most parameters at proven Kalman_MACD_Adaptive_v1 defaults
# - Test 2 VIX EMA periods: [20, 50] - NEW
# - Test 2 Kalman measurement_noise values: [2000.0, 5000.0]
# - Test 2 risk_leveraged values: [0.02, 0.025]
# - Keep all other parameters at defaults
#
# Total combinations: 2 * 2 * 2 * 2 = 16 runs
# Estimated runtime: 5-10 minutes
#
# Purpose: Quick validation before running full grid search (3,888 runs)

# Strategy to optimize
strategy: "Hierarchical_Adaptive_v1"

# Symbol Sets
# -----------
# This strategy requires 4 symbols (VIX added vs Kalman_MACD_Adaptive_v1):
# - signal_symbol (QQQ): Used for Kalman filter, EMA, and MACD calculations
# - bull_symbol (TQQQ): 3x leveraged long for STRONG_BULL regime
# - bear_symbol (SQQQ): 3x inverse for BEAR regime
# - defense_symbol (QQQ): 1x for MODERATE_BULL regime
# - vix_symbol (VIX): Volatility filter (master switch) - NEW
symbol_sets:
  - name: "QQQ_TQQQ_SQQQ_VIX"
    signal_symbol: "QQQ"      # Kalman filter calculations
    bull_symbol: "TQQQ"       # 3x leveraged long for aggressive regime
    defense_symbol: "QQQ"     # 1x for moderate regime
    bear_symbol: "SQQQ"       # 3x inverse for bear regime
    vix_symbol: "VIX"         # Volatility filter (master switch) - NEW

# Base Configuration
# ------------------
# Fixed settings applied to ALL backtests
base_config:
  # Date range - Default: Full history (2010-2024)
  # Includes: Financial crisis recovery, bull market, COVID crash, recovery
  start_date: "2010-03-01"
  end_date: "2025-11-01"

  # Market data
  timeframe: "1D"

  # Portfolio settings
  initial_capital: 100000  # Matches strategy spec ($100,000)
  commission: 0.0          # Strategy spec: $0.00 per trade
  slippage: 0.0005         # Strategy spec: 0.05% per trade

# Parameters to Optimize
# ----------------------
# FOCUSED PARAMETER SET: Only test critical new parameter (VIX) and
# a few key parameters from Kalman_MACD_Adaptive_v1
#
# Total combinations: 2 * 2 * 2 * 2 = 16
# Estimated runtime: 5-10 minutes

parameters:
  # ============================================================================
  # TIER 0: VIX VOLATILITY FILTER (Master Risk Switch) - NEW
  # ============================================================================
  # Test 2 VIX EMA periods to validate VIX filter effectiveness
  # - 20: Strategy spec default (from successful MACD_Trend-v6)
  # - 50: Slower-reacting VIX filter (less whipsaw)

  vix_ema_period: [20, 50]  # NEW PARAMETER

  # ============================================================================
  # TIER 1: KALMAN FILTER PARAMETERS (Reduced for focused test)
  # ============================================================================
  # Test 2 measurement_noise values to validate regime classification
  # - 2000.0: More responsive Kalman filter
  # - 5000.0: Strategy spec default (from Kalman_MACD_Adaptive_v1)

  measurement_noise: [2000.0, 5000.0]

  # Fixed at defaults (not optimized in focused test)
  osc_smoothness: [20]                # Default
  strength_smoothness: [20]           # Default
  process_noise_1: [0.01]             # Default
  process_noise_2: [0.01]             # Default

  # ============================================================================
  # TIER 2: REGIME THRESHOLD PARAMETERS (Fixed at defaults)
  # ============================================================================
  # Keep all thresholds at defaults for focused test

  thresh_strong_bull: [60]            # Default
  thresh_moderate_bull: [20]          # Default
  thresh_moderate_bear: [-20]         # Default

  # ============================================================================
  # TIER 3: RISK MANAGEMENT PARAMETERS (Reduced for focused test)
  # ============================================================================
  # Test 2 risk_leveraged values to validate position sizing
  # - 0.02: Conservative (2% risk per leveraged trade)
  # - 0.025: Strategy spec default (2.5% risk per leveraged trade)

  atr_stop_multiplier: [2.0]          # Fixed at conservative value
  risk_leveraged: [0.02, 0.025]       # Test 2 values
  allocation_unleveraged: [0.8]       # Fixed at default

  # ============================================================================
  # TIER 4: REGIME-SPECIFIC PARAMETERS (Fixed at defaults)
  # ============================================================================
  # All regime-specific parameters fixed at strategy spec defaults
  # Will optimize these in full grid search if focused test shows promise

  # Strong Bull Regime
  ema_trend_sb: [100]
  macd_fast_sb: [12]
  macd_slow_sb: [26]
  macd_signal_sb: [9]

  # Moderate Bull Regime
  ema_trend_mb: [150]
  macd_fast_mb: [20]
  macd_slow_mb: [50]
  macd_signal_mb: [12]

  # Bear Regime
  ema_trend_b: [100]
  macd_fast_b: [12]
  macd_slow_b: [26]
  macd_signal_b: [9]

  # ATR Calculation
  atr_period: [14]

# Optional Constraints
# --------------------
# Safety limits for focused test run

# Maximum total combinations to run
# Current combinations: 16
max_combinations: 20

# Checkpoint interval
# Save progress every N backtests for resume capability
checkpoint_interval: 5

# Expected Output
# ---------------
# output/grid_search_Hierarchical_Adaptive_v1_YYYYMMDD_HHMMSS_focused/
# ├── summary_comparison.csv   # Metrics for all 16 runs (sortable)
# ├── run_config.csv          # Parameter mapping (which run = which params)
# ├── parameters.yaml         # Copy of this config file
# ├── README.txt             # Summary statistics and top performers
# ├── run_001/               # First parameter combination
# │   ├── portfolio_daily.csv
# │   ├── trades.csv
# │   └── summary.csv
# ├── run_002/               # Second parameter combination
# │   ├── portfolio_daily.csv
# │   ├── trades.csv
# │   └── summary.csv
# └── ... (14 more runs)

# Usage
# -----
# jutsu grid-search --config grid-configs/examples/grid_search_hierarchical_adaptive_v1_focused.yaml
#
# After completion:
# 1. Open summary_comparison.csv
# 2. Sort by Sharpe Ratio (highest to lowest)
# 3. Review top 5 parameter combinations
# 4. Key questions to answer:
#    - Does VIX filter improve risk-adjusted returns vs Kalman_MACD_Adaptive_v1?
#    - Does VIX=20 or VIX=50 perform better?
#    - Does measurement_noise=2000 or 5000 perform better?
#    - Does risk_leveraged=0.02 or 0.025 perform better?
# 5. If results promising, proceed to full grid search (3,888 runs)
# 6. If results poor, revisit VIX filter implementation or strategy design

# Research Rationale
# ------------------
# FOCUSED TEST STRATEGY:
#
# Why only 16 runs?
# - Fast validation (<10 min runtime) before committing to full grid search
# - Validates VIX filter adds value over Kalman_MACD_Adaptive_v1 baseline
# - Tests critical new parameter (vix_ema_period) with 2 values
# - Tests 2 proven parameters (measurement_noise, risk_leveraged) for interaction
# - Keeps all other parameters at proven defaults from Kalman_MACD_Adaptive_v1
#
# What are we testing?
# 1. VIX Filter Effectiveness: Does VIX EMA(20) or EMA(50) improve risk-adjusted returns?
# 2. VIX-Kalman Interaction: Does VIX filter work well with measurement_noise=2000 or 5000?
# 3. Risk Sizing Impact: Does 2% or 2.5% risk per leveraged trade work better with VIX filter?
# 4. Baseline Comparison: Does Hierarchical beat Kalman_MACD_Adaptive_v1 baseline?
#
# Expected Outcomes:
# ✅ PASS: VIX filter improves Sharpe ratio by >10% vs baseline → Proceed to full grid
# ⚠️  MARGINAL: VIX filter improves Sharpe by 0-10% → Investigate further, may proceed
# ❌ FAIL: VIX filter degrades Sharpe vs baseline → Revisit VIX filter logic
#
# Next Steps:
# - If PASS/MARGINAL: Run full grid search (grid_search_hierarchical_adaptive_v1.yaml)
# - If FAIL: Debug VIX filter implementation, consider alternative volatility metrics

# Validation Criteria
# -------------------
# MINIMUM SUCCESS CRITERIA (vs Kalman_MACD_Adaptive_v1 baseline):
#
# 1. Risk-Adjusted Returns:
#    - Sharpe Ratio: >= baseline Sharpe (preferably +10-20%)
#    - Sortino Ratio: >= baseline Sortino
#    - Calmar Ratio: >= baseline Calmar
#
# 2. Risk Metrics:
#    - Max Drawdown: <= baseline drawdown (or max +5% if returns significantly higher)
#    - VIX filter should reduce drawdown in volatile periods (2020 COVID crash)
#
# 3. Trade Quality:
#    - Win Rate: >= baseline win rate
#    - Average Win/Loss: >= baseline
#    - Trades should cluster in low-VIX periods (validates VIX filter)
#
# 4. VIX Filter Behavior:
#    - VIX filter should trigger in high-volatility periods (Mar 2020, Sep 2008)
#    - Should NOT over-trigger in normal markets (< 30% time in CASH due to VIX)
#    - Regime changes should be smooth with VIX filter
#
# Analysis Checklist:
# - [ ] Compare top focused run vs Kalman_MACD_Adaptive_v1 best run
# - [ ] Analyze VIX filter trigger frequency and timing
# - [ ] Check performance during 2020 COVID crash (VIX filter critical test)
# - [ ] Verify VIX filter doesn't over-constrain trading (>70% time invested)
# - [ ] Review parameter stability (do results vary wildly across 16 runs?)
