# Grid Search Configuration for MACD Trend V4 Strategy
# ========================================================
# This example demonstrates parameter optimization across multiple symbol sets
#
# Purpose: Find optimal parameters for MACD_Trend_v4 strategy by testing
#          all combinations of EMA period, ATR stop multiplier, and risk sizing
#
# Total Backtests: 2 symbol_sets × (5 ema × 3 atr × 3 risk) = 90 backtests
# Estimated Runtime: ~15-30 minutes (depends on system and data availability)

# Strategy to optimize
strategy: MACD_Trend_v4

# Symbol Sets
# -----------
# Each set groups signal/bull/defense symbols to prevent invalid mixing
# Signal: Symbol used for MACD/EMA signals
# Bull: Leveraged ETF used during bullish regimes
# Defense: Conservative position during bearish regimes
symbol_sets:
  # - name: "NVDA-NVDL"
  #   signal_symbol: NVDA      # Nvidia for signals
  #   bull_symbol: NVDL        # 2x leveraged Nvidia ETF
  #   defense_symbol: NVDA     # Fall back to unleveraged

  - name: "QQQ-TQQQ"
    signal_symbol: QQQ       # Nasdaq-100 for signals
    bull_symbol: TQQQ        # 3x leveraged Nasdaq ETF
    defense_symbol: QQQ      # Fall back to unleveraged

# Base Configuration
# ------------------
# Fixed settings applied to ALL backtests
# These parameters remain constant across all optimization runs
base_config:
  # Date range
  start_date: "2010-04-01"
  end_date: "2025-11-01"

  # Market data
  timeframe: "1D"           # Daily bars

  # Portfolio settings
  initial_capital: 10000   # $100,000 starting capital
  commission: 0.0          # $0.01 per share commission
  slippage: 0.0             # No slippage modeling

# Parameters to Optimize
# ----------------------
# Grid search will test ALL combinations of these parameters
# Use lists with multiple values for parameters you want to optimize
# Use single-value lists for parameters you want to keep constant

parameters:
  # Trend Filter - EMA Period
  # -------------------------
  # Determines trend regime (bull vs bear)
  # Lower values = more sensitive to price changes
  # Higher values = smoother, less whipsaw
  # Testing: 50, 100, 150, 200, 250 days
  ema_period: [50, 100, 75, 200, 250, 25]
  # ema_period: [50, 100]

  # Risk Management - ATR Stop Loss Multiplier
  # -------------------------------------------
  # Stop loss distance = ATR × multiplier
  # Lower values = tighter stops, less drawdown, more frequent stops
  # Higher values = wider stops, more drawdown, fewer stops
  # Testing: 2.0×, 3.0×, 4.0× ATR
  atr_stop_multiplier: [2.0, 3.0, 1.0, 2.5]
  # atr_stop_multiplier: [2.0]

  # Position Sizing - Risk Per Trade (Bull Regime)
  # -----------------------------------------------
  # Percentage of capital risked per trade
  # Lower values = smaller positions, less volatility
  # Higher values = larger positions, more volatility
  # Testing: 2%, 2.5%, 3% risk per trade
  risk_bull: [0.04, 0.05, 0.06]
  # risk_bull: [0.02]

  # MACD Parameters (keeping defaults)
  # -----------------------------------
  # Standard MACD(12, 26, 9) configuration
  # Not optimizing these to reduce combinations
  macd_fast_period: [12]
  macd_slow_period: [26]
  macd_signal_period: [9]

  # ATR Period (keeping default)
  # ----------------------------
  # Standard 14-period ATR for volatility measurement
  atr_period: [14]

  # Defense Allocation (keeping default)
  # ------------------------------------
  # Percentage of capital in defense during bear regime
  # 60% allocation = 40% cash reserve
  allocation_defense: [0.60, 0.5, 0.7]

# Optional Constraints
# --------------------
# Safety limits to prevent accidental large-scale runs

# Maximum total combinations to run
# If actual combinations exceed this, grid search will abort
# Current combinations: 90 (well under limit)
max_combinations: 500

# Checkpoint interval
# Save progress every N backtests for resume capability
checkpoint_interval: 10

# Expected Output
# ---------------
# output/grid_search_MACD_Trend_v4_YYYYMMDD_HHMMSS/
# ├── summary_comparison.csv   # Metrics for all 90 runs (sortable)
# ├── run_config.csv          # Parameter mapping (which run = which params)
# ├── parameters.yaml         # Copy of this config file
# ├── README.txt             # Summary statistics and top performers
# ├── run_001/               # NVDA-NVDL, ema=50, atr=2.0, risk=0.02
# │   ├── portfolio_daily.csv
# │   └── trades.csv
# ├── run_002/               # NVDA-NVDL, ema=50, atr=2.0, risk=0.025
# │   ├── portfolio_daily.csv
# │   └── trades.csv
# └── ... (88 more runs)

# Usage
# -----
# jutsu grid-search --config configs/examples/grid_search_macd_v4.yaml
#
# After completion:
# 1. Open summary_comparison.csv
# 2. Sort by Sharpe_Ratio (highest to lowest)
# 3. Review top 5-10 parameter combinations
# 4. Look for consistent patterns (e.g., do higher EMA periods always win?)
# 5. Check for overfitting (parameters that work for one symbol but not others)
# 6. Run focused grid search on promising parameter ranges
